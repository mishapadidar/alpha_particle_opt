import numpy as np

def gauss_quadrature_nodes_coeffs(n_nodes=2,a=-1.0,b=1.0):
  """
  Return the roots and coefficients for gauss quadrature.

  With n_nodes nodes we can integrate any polynomial of degree
  2*n_nodes-1 exactly.

  Taken from Numerical Analysis, Burden and Faires

  n_nodes: number of quadrature nodes. 
  a,b: left and right hand side bounds of the integral.
  """
  assert n_nodes >= 2
  assert n_nodes <= 10

  roots = [[0.5773502692,-0.5773502692], # 2 nodes
           [0.7745966692,0.0000000000,-0.7745966692], # 3 nodes
           [0.8611363116,0.3399810436,-0.3399810436,-0.8611363116],
           [0.9061798459,0.5384693101,0.0000000000,-0.5384693101,-0.9061798459],
           [-0.9324695142031520278123,-0.661209386466264513661,-0.2386191860831969086305,0.238619186083196908631,0.661209386466264513661,0.9324695142031520278123],
           [-0.949107912342758525,-0.74153118559939444,-0.405845151377397167,0.0,0.405845151377397167,0.74153118559939444,0.949107912342758525],
           [-0.960289856497536232,-0.79666647741362674,-0.525532409916328986,-0.183434642495649805,0.183434642495649805,0.525532409916328986,0.79666647741362674,0.960289856497536232],
           [-0.96816023950762609,-0.836031107326635794,-0.613371432700590397,-0.32425342340380893,0.0,0.32425342340380893,0.613371432700590397,0.836031107326635794,0.96816023950762609],
           [-0.97390652851717172,-0.86506336668898451,-0.679409568299024406,-0.433395394129247191,-0.14887433898163121,0.148874338981631211,0.433395394129247191,0.679409568299024406,0.865063366688984511,0.97390652851717172]
           ]
  coeffs = [[1.0,1.0],
            [0.5555555556,0.8888888889,0.5555555556],
            [0.3478548451,0.6521451549,0.6521451549,0.3478548451],
            [0.2369268850,0.4786286705,0.5688888889,0.4786286705,0.2369268850],
            [0.1713244923791703450403,0.3607615730481386075698,0.4679139345726910473899,0.46791393457269104739,0.3607615730481386075698,0.1713244923791703450403],
            [0.129484966168869693,0.279705391489276668,0.381830050505118945,0.417959183673469388,0.38183005050511894,0.279705391489276668,0.129484966168869693],
            [0.101228536290376259,0.22238103445337447,0.313706645877887287,0.362683783378361983,0.36268378337836198,0.313706645877887287,0.222381034453374471,0.10122853629037626],
            [0.081274388361574412,0.1806481606948574,0.260610696402935462,0.31234707704000284,0.33023935500125976,0.31234707704000284,0.26061069640293546,0.180648160694857404,0.081274388361574412],
            [0.066671344308688138,0.14945134915058059,0.219086362515982044,0.26926671930999636,0.29552422471475287,0.29552422471475287,0.269266719309996355,0.21908636251598204,0.14945134915058059,0.066671344308688138]
           ]

  # transform to other interval
  nodes = ((b-a)*np.array(roots[n_nodes-2]) + (b+a))/2.0
  coeffs = np.array(coeffs[n_nodes-2])*(b-a)/2.0

  return nodes,coeffs


if __name__ == "__main__":

  f = lambda x : x**2 -2*x - 3
  fint = lambda x: x**3 / 3 - x**2 -3*x # integral
  a = -1.0
  b = 1.0
  true_int = fint(b) - fint(a)
  nodes,coeffs = gauss_quadrature_nodes_coeffs(n_nodes=2,a=a,b=b)
  fX = f(nodes)
  print(fX @ coeffs)
  print(true_int)
 
  f = lambda x : x**2 -2*x - 3
  fint = lambda x: x**3 / 3 - x**2 -3*x # integral
  a = -7.0
  b = 9.21
  true_int = fint(b) - fint(a)
  nodes,coeffs = gauss_quadrature_nodes_coeffs(n_nodes=2,a=a,b=b)
  fX = f(nodes)
  print(fX @ coeffs)
  print(true_int)


  f = lambda x : 13*x**7 -102.8*x**5 + x**2 -2*x - 14.
  fint = lambda x: 13*x**8 / 8 - 102.8*x**6/6 + x**3 / 3 - x**2 -14*x # integral
  a = -1.0
  b = 4.0
  true_int = fint(b) - fint(a)
  n_nodes = 4
  nodes,coeffs = gauss_quadrature_nodes_coeffs(n_nodes=n_nodes,a=a,b=b)
  fX = f(nodes)
  print(fX @ coeffs)
  print(true_int)


  f = lambda x : 13*x**12 -102.8*x**5 + x**2 -2*x - 14.
  fint = lambda x: 13*x**13 / 13 - 102.8*x**6/6 + x**3 / 3 - x**2 -14*x # integral
  a = -1.0
  b = 4.0
  true_int = fint(b) - fint(a)
  n_nodes = 7
  nodes,coeffs = gauss_quadrature_nodes_coeffs(n_nodes=n_nodes,a=a,b=b)
  fX = f(nodes)
  print(fX @ coeffs)
  print(true_int)

  f = lambda x : 13*x**19 -102.8*x**5 + x**2 -2*x - 14.
  fint = lambda x: 13*x**20 / 20 - 102.8*x**6/6 + x**3 / 3 - x**2 -14*x # integral
  a = -1.0
  b = 4.0
  true_int = fint(b) - fint(a)
  n_nodes = 10
  nodes,coeffs = gauss_quadrature_nodes_coeffs(n_nodes=n_nodes,a=a,b=b)
  fX = f(nodes)
  print(fX @ coeffs)
  print(true_int)
